# extend base image to copy shared dependencies
FROM exbotanical/vue-forum-base as base

FROM node:alpine

WORKDIR /base
# copy shared node_modules
COPY --from=base /base/node_modules /base/node_modules
# copy transitive / peer dependencies - (pkg 'common' is required by auth service)
COPY --from=base /base/packages/common /base/packages/common
# copy base tsconfigs
COPY --from=base /base/packages/tsconfig.settings.json /base/packages/tsconfig.settings.json
COPY --from=base /base/packages/tsconfig.json /base/packages/tsconfig.json
# copy auth-service
COPY --from=base /base/packages/auth /base/packages/auth
# create logs dir if not extant
RUN mkdir -p /base/packages/auth/logs

WORKDIR /base/packages/auth

CMD ["yarn", "run", "dev"]